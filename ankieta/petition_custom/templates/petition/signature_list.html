{% extends 'petition/base.html' %}
{% load crispy_forms_tags webdesign %}

{% block css %}
{{block.super}}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<style>
    #map {
        height: 450px;
    }
    .leaflet-popup-content {
        color:#000;
    }

</style>
{% endblock %}
{% block javascript %}
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
{{block.super}}
<script>
    $(function() {
        map = new L.Map('map');
        var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var osmAttrib='Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
        var osm = new L.TileLayer(osmUrl, {minZoom: 1, maxZoom: 18, attribution: osmAttrib});

        map.setView(new L.LatLng(54.26, 21.137), 5);
        $.getJSON( "{% url 'petition:list_api' %}").done(function(data){
            $.each(data, function(i, val){
                var marker = L.marker([val['lat'], val['lng']]).addTo(map);
                marker.bindPopup(val['first_name']+" "+val['second_name']);
            });
        });
        map.addLayer(osm);
    });
</script>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-sm-12 col-md-8">
        <div class="widget">
            <div class="widget-title">
                Lista podpisów
            </div>
            {% if petitions|length >= 2 %}
            {% for p in petitions %}
                {{p}}(<a href="{{p.get_absolute_url}}">Treść</a>, <a href="{% url 'petition:list' slug=p.slug%}"> {{p.signature_count}} podpisów</a>)
            {% endfor %}
            {% endif %}

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Imię i nazwisko</th>
                        <th>Miejscowość{% include 'petition/_links_sort.html' with column='city'%}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for object in object_list %}
                    <tr>
                        <th scope="row">{{ object.pk }}</th>
                        <td>{{ object.name }}</td>
                        <td>{{ object.city }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if page_obj.has_previous or page_obj.has_next %}

            <ul class="pager">
                {% if page_obj.has_previous %}
                <li class="previous">
                    <a href="?order_by={{order_by}}&ordering={{ordering}}&page={{page.previous_page_number}}"><span aria-hidden="true">&larr;</span> Poprzednie</a></a>
                </li>
                {% endif %}
                <li>{{page_obj.number}} z {{page_obj.paginator.num_pages}}</li>
                {% if page_obj.has_next %}
                <li class="next">
                    <a href="?order_by={{order_by}}&ordering={{ordering}}&page={{page_obj.next_page_number}}">Kolejne <span aria-hidden="true">&rarr;</span></a>
                </li>
                {% endif %}
            </ul>
            {% endif %}
        </div>
    </div>
    <div class="col-sm-12 col-md-4">
        <div class="widget">
            <div class="text-center counter-number">{{count}}</div>
            <div class="text-center">podpisów</div>
        </div>
        <div class="widget">
            {{petition.read_text | safe}}
        </div>

    </div>
</div>
{% endblock %}
